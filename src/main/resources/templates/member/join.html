<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>회원가입</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
</head>
<body>
<div th:replace="~{/fragment/header :: header}"></div>

<div class="container w-50 mt-3">
    <h1 class="h3 mb-3 fw-normal text-center">회원가입</h1>

    <div class="form-floating m-2">
        <input type="text" class="form-control" id="loginId" placeholder="id">
        <label for="loginId">id</label>
        <div id="loginIdError" class="text-danger error-msg"></div>
    </div>
    <div class="form-floating m-2">
        <input type="text" class="form-control" id="name" placeholder="name">
        <label for="name">name</label>
        <div id="nameError" class="text-danger error-msg"></div>
    </div>

    <div class="form-floating m-2">
        <input type="password" class="form-control" id="password" placeholder="Password">
        <label for="password">Password</label>
        <div id="passwordError" class="text-danger error-msg"></div>
    </div>

    <div class="form-floating m-2">
        <input type="text" class="form-control" id="phoneNumber" placeholder="phoneNumber">
        <label for="phoneNumber">phoneNumber</label>
        <div id="phoneNumberError" class="text-danger error-msg"></div>
    </div>

    <div class="form-floating m-2">
        <input type="email" class="form-control" id="email" placeholder="email">
        <label for="email">email</label>
        <div id="emailError" class="text-danger error-msg"></div>
    </div>

    <div class="d-flex justify-content-center">
        <button class="btn btn-primary w-25 py-2" id="joinButton">회원 가입</button>
    </div>
    <p class="mt-5 mb-3 text-body-secondary">© 2017–2024</p>
</div>
</body>

<script>
    const joinButton = document.getElementById('joinButton');

    joinButton.addEventListener('click', event=> {

        document.getElementById('loginIdError').textContent = '';
        document.getElementById('nameError').textContent = '';
        document.getElementById('passwordError').textContent = '';
        document.getElementById('phoneNumberError').textContent = '';
        document.getElementById('emailError').textContent = '';

        fetch("/api/members",{
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                loginId: document.getElementById("loginId").value,
                name: document.getElementById("name").value,
                password: document.getElementById("password").value,
                phoneNumber: document.getElementById("phoneNumber").value,
                email: document.getElementById("email").value
            })
        }).then(response =>{
            if(!response.ok){
                return response.json().then(errorMessages => {
                    throw errorMessages;
                })
            }
            return response.json();
        })
            .then(() => {
            alert("회원가입이 완료되었습니다.")
            location.replace("/")
        }).catch(errorMessages => {
            if (typeof errorMessages === 'object') {
                for (const [field, message] of Object.entries(errorMessages)) {
                    const errorElement = document.getElementById(`${field}Error`);
                    if (errorElement) {
                        errorElement.textContent = message;
                    }
                }
            } else {
                alert("회원가입에 실패하였습니다.");
                location.replace("/member/join");
            }
        });
    })

</script>

</html>